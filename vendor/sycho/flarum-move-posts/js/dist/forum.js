module.exports=function(t){var o={};function s(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=o,s.d=function(t,o,e){s.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:e})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,o){if(1&o&&(t=s(t)),8&o)return t;if(4&o&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(s.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var n in t)s.d(e,n,function(o){return t[o]}.bind(null,n));return e},s.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(o,"a",o),o},s.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},s.p="",s(s.s=20)}([function(t,o){t.exports=flarum.core.compat["forum/app"]},function(t,o){t.exports=flarum.core.compat["common/extend"]},function(t,o){t.exports=flarum.core.compat["common/components/Button"]},function(t,o){t.exports=flarum.core.compat["forum/components/CommentPost"]},function(t,o){t.exports=flarum.core.compat["forum/components/DiscussionPage"]},function(t,o){t.exports=flarum.core.compat["common/models/Discussion"]},function(t,o){t.exports=flarum.core.compat["common/components/Badge"]},function(t,o){t.exports=flarum.core.compat["forum/components/Post"]},function(t,o){t.exports=flarum.core.compat["forum/utils/PostControls"]},function(t,o){t.exports=flarum.core.compat["common/helpers/icon"]},function(t,o){t.exports=flarum.core.compat["common/Model"]},function(t,o){t.exports=flarum.core.compat["common/utils/Stream"]},function(t,o){t.exports=flarum.core.compat["common/components/Modal"]},function(t,o){t.exports=flarum.core.compat["common/components/Switch"]},function(t,o){t.exports=flarum.core.compat["uikit/forum/DiscussionSearch"]},function(t,o){t.exports=flarum.core.compat["forum/states/GlobalSearchState"]},function(t,o){t.exports=flarum.core.compat["forum/components/EventPost"]},function(t,o){t.exports=flarum.core.compat["common/components/Link"]},function(t,o){t.exports=flarum.core.compat["forum/components/Notification"]},,function(t,o,s){"use strict";s.r(o);var e=s(1),n=s(0),r=s.n(n),a=s(2),i=s.n(a),c=s(6),u=s.n(c),p=s(7),l=s.n(p),d=s(3),f=s.n(d),h=s(4),v=s.n(h),y=s(8),g=s.n(y),b=s(9),_=s.n(b),x=s(5),P=s.n(x),w=s(10),M=s.n(w),D=s(11),T=s.n(D),N=function(){function t(){this.selectedPostsToMove=void 0,this.selectedPostsToMove=T()([])}var o=t.prototype;return o.push=function(t){this.selectedPostsToMove([].concat(this.selectedPostsToMove(),[t]))},o.remove=function(t){this.selectedPostsToMove(this.selectedPostsToMove().filter((function(o){return o!==t})))},o.has=function(t){return this.selectedPostsToMove().includes(t)},t}();function O(t,o){return(O=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t})(t,o)}function j(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,O(t,o)}var I=s(12),k=s.n(I),F=s(13),S=s.n(F),L=s(14),B=s.n(L),C=s(15),A=s.n(C),q=function(t){function o(){for(var o,s=arguments.length,e=new Array(s),n=0;n<s;n++)e[n]=arguments[n];return(o=t.call.apply(t,[this].concat(e))||this).isLoading=!1,o.newDiscussion=!1,o.newDiscussionTitle="",o.targetDiscussionId=null,o.search=new A.a,o}j(o,t);var s=o.prototype;return s.className=function(){return"Modal--small MovePostsModal"},s.title=function(){return app.translator.trans("sycho-move-posts.forum.modal.title")},s.content=function(){var t=this;return m("div",{className:"Modal-body"},m("form",{className:"Form",onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("label",null,app.translator.trans("sycho-move-posts.forum.modal.selected_posts",{count:this.attrs.postIds.length})),m("input",{className:"FormControl",readonly:!0,value:this.attrs.postIds.join(", ")})),m("div",{className:"Form-group"},m(S.a,{state:this.newDiscussion,onchange:function(){return t.newDiscussion=!t.newDiscussion}},app.translator.trans("sycho-move-posts.forum.modal.new_discussion"))),this.newDiscussion?m("div",{className:"Form-group"},m("label",{for:"discussion_name"},app.translator.trans("sycho-move-posts.forum.modal.discussion_name")),m("p",{className:"helptext"},app.translator.trans("sycho-move-posts.forum.modal.discussion_help")),m("input",{id:"discussion_name",className:"FormControl",required:!0,oninput:function(o){return t.newDiscussionTitle=o.target.value}})):m("div",{className:"Form-group"},m("label",{for:"destination"},app.translator.trans("sycho-move-posts.forum.modal.destination")),m(B.a,{state:this.search,ignore:this.attrs.discussion.id(),onSelect:function(o){return t.targetDiscussionId=o.id()}})),m("div",{className:"Form-group Form-controls"},m(i.a,{className:"Button Button--primary",type:"submit",loading:"submit"===this.isLoading,disabled:"check"===this.isLoading||!this.targetDiscussionId&&!this.newDiscussionTitle},app.translator.trans("sycho-move-posts.forum.modal.submit")),m(i.a,{className:"Button",onclick:this.emulate.bind(this),loading:"check"===this.isLoading,disabled:"submit"===this.isLoading||!this.targetDiscussionId&&!this.newDiscussionTitle},app.translator.trans("sycho-move-posts.forum.modal.check")))))},s.data=function(){var t={sourceDiscussionId:this.attrs.discussion.id(),postIds:this.attrs.postIds};return this.newDiscussion?(t.newDiscussion=!0,t.newDiscussionTitle=this.newDiscussionTitle):t.targetDiscussionId=this.targetDiscussionId,t},s.emulate=function(){var t=this;this.onsubmit(null,!0).then((function(o){switch(o.data.attributes.status){case"old_to_new_move":t.alertAttrs={type:"error",content:app.translator.trans("sycho-move-posts.forum.modal.status.old_to_new_move")};break;case"simple_move":t.alertAttrs={type:"success",content:app.translator.trans("sycho-move-posts.forum.modal.status.simple_move")};break;case"complex_move":t.alertAttrs={type:"warning",content:app.translator.trans("sycho-move-posts.forum.modal.status.complex_move")}}m.redraw()}))},s.onsubmit=function(t,o){var s=this;t&&t.preventDefault(),this.isLoading=o?"check":"submit";var e="/api/posts/move";return o&&(e+="/check"),app.request({method:"POST",url:""+app.forum.attribute("baseUrl")+e,body:{data:this.data()},errorHandler:function(t){var o=t.response.errors[0];if(s.isLoading=!1,"move_old_post_to_newer_discussion"!==o.code)throw t;s.alertAttrs={type:"error",content:app.translator.trans("sycho-move-posts.forum.error.move_old_post_to_newer_discussion")},m.redraw()}}).then((function(t){return s.isLoading=!1,o||(m.redraw(),window.location.reload(),app.modal.close()),t}))},o}(k.a),E=s(16),z=s.n(E),G=s(17),H=s.n(G),K=function(t){function o(){return t.apply(this,arguments)||this}j(o,t);var s=o.prototype;return s.icon=function(){return"fas fa-exchange-alt"},s.descriptionKey=function(){return"sycho-move-posts.forum.post_stream.post_moved"},s.descriptionData=function(){var t=this.attrs.post.content();return{target_discussion:m(H.a,{className:"EventPost-PostMoved-target",href:app.route("discussion.near",{id:t.targetDiscussionId,near:t.number})},t.targetDiscussionTitle),count:t.count}},o}(z.a),U=s(18),J=function(t){function o(){return t.apply(this,arguments)||this}j(o,t);var s=o.prototype;return s.icon=function(){return"fas fa-exchange-alt"},s.href=function(){return app.route("discussion",{id:this.attrs.notification.content().targetDiscussionId})},s.content=function(){return app.translator.trans("sycho-move-posts.forum.notifications.post_moved_text",{targetDiscussionTitle:m("span",{className:"MovePosts-Notification-targetDiscussion"},this.attrs.notification.content().targetDiscussionTitle)})},o}(s.n(U).a);r.a.initializers.add("sycho/flarum-move-posts",(function(){if(P.a.prototype.isFirstMoved=M.a.attribute("isFirstMoved"),Object(e.extend)(P.a.prototype,"badges",(function(t){this.isFirstMoved()&&t.add("firstMoved",m(u.a,{type:"firstPostMoved",label:r.a.translator.trans("sycho-move-posts.forum.badge.first_moved_tooltip"),icon:"fas fa-exchange-alt"}),-20)})),r.a.postComponents.postMoved=K,r.a.notificationComponents.postMoved=J,r.a.data.resources[0].attributes.canMovePosts){var t=new N;Object(e.extend)(f.a.prototype,"oninit",(function(){this.subtree.check((function(){return t.selectedPostsToMove()}))})),Object(e.extend)(l.a.prototype,"classes",(function(o){"comment"===this.attrs.post.contentType()&&t.has(this.attrs.post.id())&&o.push("Post--moving")})),Object(e.extend)(f.a.prototype,"headerItems",(function(o){t.has(this.attrs.post.id())&&o.add("moving",m("span",{className:"PostMoving"},_()("fas fa-exchange-alt")," ",r.a.translator.trans("sycho-move-posts.forum.post.moving")))})),Object(e.extend)(v.a.prototype,"oncreate",(function(){t.selectedPostsToMove([])})),Object(e.extend)(v.a.prototype,"sidebarItems",(function(o){var s=this;t.selectedPostsToMove().length&&o.add("movePosts",m(i.a,{icon:"fas fa-exchange-alt",className:"Button",onclick:function(){return r.a.modal.show(q,{postIds:t.selectedPostsToMove(),discussion:s.discussion})}},r.a.translator.trans("sycho-move-posts.forum.discussion.move_posts"),m("span",{className:"MovePosts-Button-count"},t.selectedPostsToMove().length)))})),Object(e.extend)(g.a,"moderationControls",(function(o,s){if("comment"===s.contentType()){var e=t.has(s.id())?"unmove":"move";o.add("movePost",m(i.a,{icon:"fas fa-arrow-right",onclick:function(){"move"===e?t.push(s.id()):t.remove(s.id()),m.redraw()}},r.a.translator.trans("sycho-move-posts.forum.post."+e)))}}))}}))}]);
//# sourceMappingURL=forum.js.map