(()=>{var t={n:s=>{var i=s&&s.__esModule?()=>s.default:()=>s;return t.d(i,{a:i}),i},d:(s,i)=>{for(var e in i)t.o(i,e)&&!t.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:i[e]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s);const i=flarum.core.compat["common/extend"],e=flarum.core.compat.app;var a=t.n(e);const o=flarum.core.compat.Model;var c=t.n(o);const n=flarum.core.compat["models/Discussion"];var r=t.n(n);const u=flarum.core.compat["common/components/DiscussionListItem"];var l=t.n(u);function k(t,s){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},k(t,s)}function d(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,k(t,s)}const g=flarum.core.compat["forum/app"];var p=t.n(g);const h=flarum.core.compat["forum/components/EventPost"];var f=function(t){function s(){return t.apply(this,arguments)||this}d(s,t);var i=s.prototype;return i.icon=function(){return p().forum.attribute("stickiest.badge_icon")},i.descriptionKey=function(){return this.attrs.post.content().stickiest?"the-turk-stickiest.forum.post_stream.discussion_super_stickied_text":"the-turk-stickiest.forum.post_stream.discussion_common_stickied_text"},s}(t.n(h)());const y=flarum.core.compat.extend,S=flarum.core.compat["components/Badge"];var b=t.n(S);const v=flarum.core.compat["forum/utils/DiscussionControls"];var _=t.n(v);const T=flarum.core.compat["common/components/Button"];var x=t.n(T);const N=flarum.core.compat["components/Modal"];var O=t.n(N);const I=flarum.core.compat["components/Button"];var D=t.n(I);const C=flarum.core.compat["tags/helpers/tagIcon"];var F=t.n(C);const M=flarum.core.compat["tags/utils/sortTags"];var w=t.n(M);const P=flarum.core.compat["utils/ItemList"];var j=t.n(P);const L=flarum.core.compat["utils/Stream"];var B=t.n(L);const H=flarum.core.compat["common/components/Switch"];var A=t.n(H),z=function(t){function s(){return t.apply(this,arguments)||this}d(s,t);var i=s.prototype;return i.oninit=function(s){t.prototype.oninit.call(this,s);var i=this.attrs.discussion,e=i.tags(),a=B()(i.stickyTags().filter((function(t){return e.indexOf(t)>-1}))||[]);this.isSticky=B()(i.isSticky()||!1),this.isStickiest=B()(i.isStickiest()||!1),this.isTagSticky=B()(i.isTagSticky()||!1),a().length>0?this.tagSlugs=w()(a()).map((function(t){return t.slug()})):this.tagSlugs=w()(e).map((function(t){return t.slug()}))},i.className=function(){return"StickiestModal"},i.title=function(){return a().translator.trans("the-turk-stickiest.forum.stickiest_modal.title",{title:m("em",null,this.attrs.discussion.title())})},i.content=function(){return[m("div",{className:"Modal-body"},m("div",{className:"Form"},this.bodyFields().toArray())),m("div",{className:"Modal-footer"},this.footerFields().toArray())]},i.bodyFields=function(){var t=this,s=new(j());return s.add("sticky",m("div",{className:"Form-group"},A().component({state:!!Number(this.isSticky()),onchange:function(s){!0===s&&(t.isStickiest=t.isTagSticky=B()(!1)),t.isSticky=B()(s)}},a().translator.trans("the-turk-stickiest.forum.stickiest_modal.sticky_label")),m("div",{className:"helpText"},a().translator.trans("the-turk-stickiest.forum.stickiest_modal.sticky_text"))),30),this.attrs.discussion.canStickiest()&&s.add("stickiest",m("div",{className:"Form-group"},A().component({state:!!Number(this.isStickiest()),onchange:function(s){!0===s&&(t.isSticky=B()(!1)),t.isStickiest=B()(s)}},a().translator.trans("the-turk-stickiest.forum.stickiest_modal.super_sticky_label")),m("div",{className:"helpText"},a().translator.trans("the-turk-stickiest.forum.stickiest_modal.super_sticky_text"))),20),this.attrs.discussion.canTagSticky()&&s.add("tagSticky",m("div",{className:"Form-group"},A().component({state:!!Number(this.isTagSticky()),onchange:function(s){!0===s&&(t.isSticky=B()(!1)),t.isTagSticky=B()(s)}},a().translator.trans("the-turk-stickiest.forum.stickiest_modal.tag_sticky_label")),m("div",{className:"helpText"},a().translator.trans("the-turk-stickiest.forum.stickiest_modal.tag_sticky_text"))),10),s},i.footerFields=function(){var t=this,s=new(j());return this.attrs.discussion.canTagSticky()&&this.isTagSticky()&&s.add("tags",m("div",{className:"Form-group StickiestModal-tags"},m("label",null,a().translator.trans("the-turk-stickiest.forum.stickiest_modal.tags_label")),m("div",null,this.attrs.discussion.tags().map((function(s){return m("label",{className:"checkbox"},m("input",{type:"checkbox",checked:t.tagSlugs.indexOf(s.slug())>-1,onchange:function(i){if(!i.target.checked||t.tagSlugs.indexOf(s.slug())>-1){if(!i.target.checked){var e=t.tagSlugs.indexOf(s.slug());e>-1&&t.tagSlugs.splice(e,1)}}else t.tagSlugs.push(s.slug())},disabled:!s.canStartDiscussion()}),F()(s)," ",s.name())})))),10),s.add("submit",m("div",{className:"Form-group"},D().component({className:"Button",type:"submit",loading:this.loading,disabled:this.isTagSticky()&&!(this.tagSlugs.length>0)},a().translator.trans("the-turk-stickiest.forum.stickiest_modal.submit_button"))),-10),s},i.applyChanges=function(){this.hide.bind(this)(),a().current.matches(DiscussionPage)&&a().current.get("stream").update(),m.redraw()},i.saveStickiest=function(){var t=this;this.attrs.discussion.save({isStickiest:!this.isSticky()&&this.isStickiest()},{errorHandler:this.onerror.bind(this)}).then(this.applyChanges.bind(this)).catch((function(){t.loading=!1,m.redraw()}))},i.onsubmit=function(t){var s=this;t.preventDefault(),this.loading=!0,this.attrs.discussion.save({isSticky:!this.isStickiest()&&!this.isTagSticky()&&this.isSticky()},{errorHandler:this.onerror.bind(this)}).then((function(){s.attrs.discussion.canTagSticky()?s.attrs.discussion.save({isTagSticky:!s.isSticky()&&s.isTagSticky()&&s.tagSlugs.length>0,tagSlugs:s.isTagSticky()?s.tagSlugs:[],relationships:{stickyTags:s.isTagSticky()?s.attrs.discussion.tags().filter((function(t){return s.tagSlugs.indexOf(t.slug())>-1})):[]}},{errorHandler:s.onerror.bind(s)}).then((function(){s.attrs.discussion.canStickiest()?s.saveStickiest.bind(s)():s.applyChanges.bind(s)()})).catch((function(){s.loading=!1,m.redraw()})):s.attrs.discussion.canStickiest()&&s.saveStickiest.bind(s)()})).catch((function(){s.loading=!1,m.redraw()}))},s}(O());a().initializers.add("the-turk-stickiest",(function(){a().postComponents.discussionSuperStickied=f,r().prototype.isStickiest=c().attribute("isStickiest"),r().prototype.isTagSticky=c().attribute("isTagSticky"),r().prototype.canStickiest=c().attribute("canStickiest"),r().prototype.canTagSticky=c().attribute("canTagSticky"),r().prototype.stickyTags=c().hasMany("stickyTags"),(0,y.extend)(r().prototype,"badges",(function(t){t.has("sticky")&&t.remove("sticky"),!this.isSticky()&&!this.isTagSticky()||this.isStickiest()||t.add(this.isTagSticky()?"tag-sticky":"sticky",b().component({type:"sticky",label:this.isTagSticky()?p().translator.trans("the-turk-stickiest.forum.badge.tag_sticky_tooltip"):p().translator.trans("the-turk-stickiest.forum.badge.sticky_tooltip"),icon:"fas fa-thumbtack"}),10)})),(0,y.extend)(r().prototype,"badges",(function(t){this.isStickiest()&&t.add(this.isTagSticky()?"tag-stickiest":"stickiest",b().component({type:"stickiest",label:this.isTagSticky()?p().translator.trans("the-turk-stickiest.forum.badge.super_tag_sticky_tooltip"):p().translator.trans("the-turk-stickiest.forum.badge.super_sticky_tooltip"),icon:p().forum.attribute("stickiest.badge_icon")}),10)})),(0,i.extend)(_(),"moderationControls",(function(t,s){s.canSticky()&&(s.canStickiest()||s.canTagSticky())&&(t.has("sticky")&&t.remove("sticky"),t.add("sticky",x().component({icon:"fas fa-thumbtack",onclick:function(){return p().modal.show(z,{discussion:s})}},p().translator.trans("the-turk-stickiest.forum.discussion_controls.sticky_button"))))})),(0,i.extend)(l().prototype,"oncreate",(function(t,s){var i=$(s.dom).find(".DiscussionListItem-content"),e=i.find(".item-sticky"),a=i.find(".item-tag-sticky"),o=i.find(".item-stickiest"),c=i.find(".item-tag-stickiest");e.length&&e.closest(".DiscussionListItem").addClass("Stickiest-stickyItem"),a.length&&a.closest(".DiscussionListItem").addClass("Stickiest-tagStickyItem"),o.length&&o.closest(".DiscussionListItem").addClass("Stickiest-stickiestItem"),c.length&&c.closest(".DiscussionListItem").addClass("Stickiest-tagStickiestItem")}))}),-1)})(),module.exports=s})();
//# sourceMappingURL=forum.js.map